!function(t,e){"use strict";var n=n||{},r=["x","y"],a=["x","y","color","area","r"],i="data-visualizer-",o=15,l=function(t,e){return e?"x"==t?"height":"width":"x"==t?"width":"height"},c=function(t){return"x"==t?"y":"x"};function s(){var t=navigator.userAgent;return t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1}String.prototype.getFileExtension=function(){return this.split(".").pop()},String.prototype.getHash=function(){var t=0,e,n;if(0===this.length)return t;for(e=0;e<this.length;e++)t=(t<<5)-t+(n=this.charCodeAt(e)),t|=0;return t},String.prototype.isValidJSONString=function(){try{JSON.parse(this)}catch(t){return!1}return!0},String.prototype.toCamelCase=function(){var t;return this.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")};var u=function(t){var e,n,r,a;return t.match(/^rgb/)?(e=(t=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],n=t[2],r=t[3]):(e=(t=+("0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&")))>>16,n=t>>8&255,r=255&t),!((a=Math.sqrt(e*e*.299+n*n*.587+r*r*.114))>170)},f=function(n,o){var f=document.querySelector(n);if(s()){var d=document.createElement("div");throw d.className=i+"wrapper fatality",d.innerHTML='Sorry, this graphic needs D3 to render the data but your browser does not support it.<br><br> Newer versions of Chrome, Edge, Firefox and Safari are recommended. <br><br>See <em><a target="_blank" rel="nofollow" href="https://d3-wiki.readthedocs.io/zh_CN/master/Home/#browser-platform-support">the official wiki</a></em> for more information',f.appendChild(d),new Error("D3 not supported")}var p={},h={width:600,height:600,margin:20,marginOffset:2,transition:2e3,delay:300,srcType:"",srcPath:"",srcKey:null,dataKey:[0,1],type:"bar",nameIsNum:!1,colorPalette:[],colorData:null,colorLegend:!1,xData:0,xAlign:"bottom",xTicks:!1,xLabel:null,xTicksAmount:null,xParameter:null,xMin:null,xMax:null,xGrid:!1,xGridIncrement:1,xPrepend:"",xAppend:"",xDivider:1,yData:1,yAlign:"left",yTicks:!1,yLabel:null,yTicksAmount:null,yParameter:null,yMin:null,yMax:null,yGrid:!1,yGridIncrement:1,yPrepend:"",yAppend:"",yDivider:1,lineStyle:"",lineWeight:1,lineColor:null,linePoints:!1,lineFill:!1,linePointsColor:null,linePointsSize:null,lineFillColor:null,lineFillOpacity:.5,lineDash:[100,0],areaKey:""},g=h;for(var y in o)o.hasOwnProperty(y)&&(g[y]=o[y]);var m=function(t){var e=0;return"pie"!==g.type&&(e=g.margin*(.75*g.marginOffset),g[t+"Label"]&&(e=g.margin*(1.5*g.marginOffset)),"x"==t&&0==g[c(t)+"Data"]&&(e=g.margin*(1.75*g.marginOffset),g[c(t)+"Label"]&&(e+=.5*g.marginOffset))),e},x=function(t,e,r){var a=e.toString().split(".");function i(t,e){var n=null;return n=e.length?i(t[e[0]],e.slice(1)):r?parseFloat(t):t}r=r||!1,a.forEach(function(t,e){""==t&&a.splice(e,1)});var o=i(t,a);return 1==r&&isNaN(o)&&console.warn(n+" data with the key source of "+e+" was passed as numeric but is not."),o},b=function(t){var e=[];switch(t){case"color":e=g[t+"Palette"];break;case"x":case"y":e="top"==g[c(t)+"Align"]||"left"==g[c(t)+"Align"]?[0,g[l(t)]]:[g[l(t)],0]}return e},v=function(t,n){var r=g[t+"Data"],a=[];switch(t){case"color":var i;a=n.reduce(function(e,n){return e.includes(x(n,g[t+"Data"]))||e.push(x(n,g[t+"Data"])),e},[]);break;case"x":case"y":var o,l;if(g.nameIsNum||1==r)a=[o=null!==g[t+"Min"]?g[t+"Min"]:e.min(n,function(t){return x(t,g.dataKey[r],!0)}),l=null!==g[t+"Max"]?g[t+"Max"]:e.max(n,function(t){return x(t,g.dataKey[r],!0)})];else a=n.map(function(t){return x(t,g.dataKey[r],!1)})}return a},_=function(t,e){var n=0;return"x"==t?"x"==e?n=g[l(e)]/2:"y"==e&&(n=-g[l(e)]/2):"x"==e?n="bottom"==g[e+"Align"]?g[l(e,!0)]+(p.off_y-.125*g.margin):-(p.off_y-1.5*g.margin):"y"==e&&(n="right"==g[e+"Align"]?g[l(e,!0)]+p.off_x:-.125*p.off_x),n},k=function(t,e,n,r){var a=g[t+"Data"],i=g.dataKey[a],o=g[c(t)+"Align"],s=20;switch(r=r||!1,g.type){case"pie":break;default:s=g.nameIsNum||1==a?r?0:"right"==o||"bottom"==o?g[l(t)]-p["the_"+t](x(e,i,i,!0)):p["the_"+t](x(e,i,i,!0)):p["the_"+t].bandwidth()}return s},w=function(t,e,n){var r=2;return n?r=0:"line"==g.type&&g.linePointsSize&&(r=g.linePointsSize),r},A=function(t,e){var n="middle";return"pie"==g.type||(0==g.yData&&(n="start"),r.forEach(function(t){0==g[c(t)+"Data"]&&"right"==g[c(t)+"Align"]&&(n="end")})),n},T=function(t,e){var n="0em";return"pie"==g.type||"y"==t&&(g.xTicks||g.yTicks||(n=1==g[e+"Data"]?".375em":"-1.625em")),n},D=function(t,e,n,r){var a=g[t+"Data"],i=0,o=function(){var e=0,r=1;return("bar"!=g.type||"top"!=g[c(t)+"Align"]&&"right"!=g[c(t)+"Align"])&&("bar"===g.type||"bottom"!=g[c(t)+"Align"]&&"right"!=g[c(t)+"Align"])||(r*=-1),0==g[c(t)+"Data"]&&(e="x"==t?15:p.mLength(t,n)/2,p.mLength(t,n)),e*=r},s=function(){var r=1,i=0;return("bar"!=g.type||"bottom"!=g[c(t)+"Align"]&&"right"!=g[c(t)+"Align"])&&("line"!=g.type||"top"!=g[c(t)+"Align"]&&"left"!=g[c(t)+"Align"])||(r=-1),("line"!==g.type&&parseFloat(k(t,e,n))<p.mLength(t,n)||"line"==g.type&&parseFloat(k(t,e,n))>=g[l(c(t))]-p.mLength(t,n))&&0!==a&&(i="x"==t&&"line"!==g.type?k(t,e,n):p.mLength(t,n)),i*=r};switch(r=r||!1,g.type){case"pie":break;default:if(0==a)i=C(t,e,n),"bar"==g.type&&(i+=k(t,e,n)/2);else switch(g[c(t)+"Align"]){case"top":i=r?C(t,e,n):k(t,e,n);break;case"right":case"bottom":i=r||"right"==g[c(t)+"Align"]&&"bar"==g.type?g[l(t)]:g[l(t)]-k(t,e,n);break;case"left":"bar"!==g.type&&(i=k(t,e,n))}i+=o()+s()}return i},C=function(t,e,n,r){var a=g[t+"Data"],i=g.dataKey[a],o=g[c(t)+"Align"],s=0;switch(r=r||!1,g.type){case"pie":break;default:g.nameIsNum||1==a?"right"==o||"bottom"==o?s=r&&0!==a?g[l(t)]:g[l(t)]-(g[l(t)]-p["the_"+t](x(e,i,!0))):"line"!=g.type&&"scatter"!=g.type||r&&0!==a||(s=p["the_"+t](x(e,i,!0))):(s=p["the_"+t](x(e,i,!1)),"line"!=g.type&&"scatter"!=g.type||g.nameIsNum||(s+=k(t,e,n)/2))}return s},P=function(t){if(p.container_legend){var e=0,n=function(){var e=0,n=1;return"left"!=g[c(t)+"Align"]&&"top"!=g[c(t)+"Align"]||(n=-1,e=.75*p.container_legend.nodes()[0].getBoundingClientRect()[l(t)]),e*n};return"left"!=g[c(t)+"Align"]&&"top"!=g[c(t)+"Align"]||(e=g[l(t)]),e+n()}},I=function(t,n,r){r=r||!1;var a=n?"area":"line",i=0==g.xData?"x":"y",o=function(){var t="curveLinear";switch(g.lineStyle){case"step":t="curveStepAfter";break;case"curve":t="curveMonotone"+i.toUpperCase()}return t}(),l=e[a]();if("area"==a){var s={name:i,value:c(i)+1,fill:c(i)+0};"right"!=g[c(i)+"Align"]&&"bottom"!=g[c(i)+"Align"]||(s.value=c(i)+0,s.fill=c(i)+1),l[s.name](function(t,e){return C(i,t,e,r)})[s.value](function(t,e){return C(c(i),t,e,r)})[s.fill](function(t,e){return C(c(i),t,e,!0)})}else l.x(function(t,e){return C("x",t,e,r)}).y(function(t,e){return C("y",t,e,r)});return o&&l.curve(e[o]),l(t)},S=function(t){var n,r=g[t+"Data"];switch(t){case"color":n=e.scaleOrdinal().range(p["range_"+t]);break;case"x":case"y":n=g.nameIsNum||1==r?e.scaleLinear().range(p["range_"+t]):e.scaleBand().range(p["range_"+t]).paddingInner(.1).paddingOuter(.1)}return n},L=function(t,n,r){if(g[t+"Ticks"]){var a=r?"grid_":"",o=g[t+"Align"];r=r||!1,g[t+"Label"]&&(p["lab_"+t]=p.container_lab.append("text").attr("class",i+"label-"+t).attr("y",function(){return _("y",t)}).attr("x",function(){return _("x",t)}).attr("font-size","1em").attr("text-anchor","middle").attr("opacity",0).text(g[t+"Label"]),"y"==t&&p["lab_"+t].attr("transform","rotate(-90)"),p["lab_"+t].transition(p.duration).attr("opacity",1)),p["rule_"+a+t]=n.append("g").attr("class",function(){var e=null;return e=r?i+"grid-"+t+" grid-increment-"+g[t+"GridIncrement"]+" tick-amount-"+g[t+"TickAmount"]:i+"axis-"+t+" "+i+"axis-align-"+o+" tick-amount"+g[t+"TickAmount"]});var s="";switch(t+" "+o){case"x bottom":s="0,"+g.height;break;case"y right":s=g.width+",0";break;default:s="0,0"}p["rule_"+a+t].attr("transform","translate("+s+")");var u="Axis "+o;if(p["axis_"+a+t]=e[u.toCamelCase()](p["the_"+t]),g[t+"Ticks"]){if(g[t+"TicksAmount"]){var f=function(){return r&&g[t+"TicksAmount"]?g[t+"TicksAmount"]*g[t+"GridIncrement"]:g[t+"TicksAmount"]};p["axis_"+a+t].ticks(f())}r?p["axis_"+a+t].tickSize(-g[l(c(t))]).tickFormat(""):p["axis_"+a+t].tickFormat(function(e,n){return p["format_"+t](e)})}}},F=function(t){var n;return e.pie().sort(null).value(function(t,e){return x(t,g.dataKey[0])})(t)},K=function(r){var l=null;switch(p.duration=e.transition().duration(g.transition),g.type){case"bar":p.graphItem="rect";break;case"pie":p.graphItem="path";case"line":case"scatter":p.graphItem="circle"}if(l=g.srcKey?x(r,g.srcKey):r,g.nameIsNum){for(var c=[],s=0;s<l.length;s++)l[s]&&c.push(l[s]);c.sort(function(t,e){return x(t,g.dataKey[0],!0)-x(e,g.dataKey[0],!0)}),l=c}o.colorData||(g.colorData=g.dataKey[0],o.colorLegend||(g.colorLegend=!1)),p.off_x=m("x"),p.off_y=m("y"),p.outerWidth=g.width+2*p.off_x,p.outerHeight=g.height+2*p.off_y,p.canvas=e.select(n).append("div").attr("class",i+"wrapper"),p.dimensionString="0 0 "+p.outerWidth+" "+p.outerHeight,p.svg=p.canvas.append("svg").attr("id",n+"-svg").attr("version","1.1").attr("x","0px").attr("y","0px").attr("class",i+"svg").attr("viewBox",p.dimensionString).attr("preserveAspectRatio","xMaxYMax meet").attr("xml:space","preserve").style("style","enable-background","new "+p.dimensionString).attr("width",p.outerWidth).attr("height",p.outerHeight),p.container=p.svg.append("g"),p.containerTransform=null;var u=1.25,d=.75,y=p.off_x,_=p.off_y;switch(g.yAlign+" "+(g.xLabel?"has":"empty")){case"left has":p.transformX=p.off_x*u;break;case"right has":p.transformX=p.off_x*d;break;default:p.transformX=p.off_x}switch(g.xAlign+" "+(g.yLabel?"has":"empty")){case"top has":p.transformX=p.off_y*u;break;case"bottom has":p.transformX=p.off_y*d;break;default:p.transformX=p.off_y}p.container.attr("transform","translate("+y+","+_+")"),"pie"==g.type?(l=F(l),console.log(l)):(p.container_lab=p.container.append("g").attr("class",i+"label"),p.container_rule=p.container.append("g").attr("class",i+"axis"),(g.xGrid||g.yGrid)&&(p.container_grid=p.container.append("g").attr("class",i+"grid")),a.forEach(function(t){switch(p["range_"+t]=b(t),p["dom_"+t]=v(t,l),p["the_"+t]=S(t),p["the_"+t]&&p["dom_"+t]&&p["the_"+t].domain(p["dom_"+t]),t){case"x":case"y":L(t,p.container_rule),p["format_"+t]="function"==typeof g[t+"Parameter"]?g[t+"Parameter"]:"string"==typeof g[t+"Parameter"]?function(n){return e.format(g[t+"Parameter"])(n)}:function(e){var n=1==g[t+"Data"]||g.nameIsNum?e/g[t+"Divider"]:e,r;return g[t+"Prepend"]+n+g[t+"Append"]},g[t+"Grid"]&&L(t,p.container_grid,!0)}}),p.container_graph=p.container.insert("g").attr("class",i+"graph "+i+"type-"+g.type+" "+i+(g.colorPalette.length>0||null!==g.linePointsColor||null!==g.lineColor?"has-palette":"no-palette")+(g.xTicks||g.yTicks?"":" "+i+"item-data-no-ticks")),g.width==h.width&&g.height==h.height&&l.length>9?console.warn(n+" Width and height was not adjusted. graph elements may not fit in the canvas"):g.width<h.width&&g.height<h.height&&console.warn(n+" set canvas width and or height may be too small.\n Tip: The given height and width are not absolute and act more like aspect ratios. svgs are responsive and will shrink along with content."),("line"!=g.type||g.linePoints)&&(p.blob=p.container_graph.selectAll(p.graphItem).data(l,function(t){return t[g.dataKey[g.xData]]}))),p.dv_init=!1,document.addEventListener("scroll",function(e){var n;f.getBoundingClientRect().y<.5*t.innerHeight&&!p.dv_init&&(p.dv_init=!0,setTimeout(function(){N(l)},g.delay))},!0)},N=function(t){console.log(n,"-------------------------------------------------------------------"),"pie"==g.type||(r.forEach(function(t){g[t+"Ticks"]&&(p["rule_"+t].transition(g.delay).call(p["axis_"+t]).attr("font-family","inherit").attr("font-size",null),g[t+"Grid"]&&(p["rule_grid_"+t].call(p["axis_grid_"+t]),p["rule_grid_"+t].selectAll(".tick").attr("class",function(e,n){var r="grid";return p["rule_"+t].selectAll(".tick").each(function(t){t==e&&(r+=" tick-aligned")}),r})))}),"line"==g.type&&(g.lineFill&&(p.fill=p.container_graph.append("path").attr("class",i+"fill"+(null!==g.lineFillColor?" has-color":" no-color")).attr("fill-opacity",0).attr("d",function(){return I(t,!0,!0)}),(g.lineFillColor||g.lineColor)&&p.fill.attr("fill",g.lineFillColor||g.lineColor),p.fill.transition(p.duration).attr("fill-opacity",g.lineFillOpacity).attr("d",function(){return I(t,!0)})),p.line=p.container_graph.append("path").attr("class",i+"line"+(null!==g.lineColor?" has-color":" no-color")).attr("fill","none").attr("stroke-width",g.lineWeight).attr("stroke-linejoin","round").attr("stroke-opacity",0).attr("d",function(){return I(t,!1,!0)}).attr("stroke-dasharray","0,0"),g.lineColor&&p.line.attr("stroke",g.lineColor),p.line.transition(p.duration).attr("d",function(){return I(t,!1)}).attr("stroke-dasharray",g.lineDash).attr("stroke-opacity",1)),("line"!=g.type||g.linePoints)&&(p.blob.exit().transition(p.duration).attr("height",0).remove(),p.blobWrap=p.blob.enter().append("g").attr("class",function(t){return i+"item "+i+x(t,g.dataKey[0])}),p.blobItem=p.blobWrap.append(p.graphItem).attr("line"==g.type||"scatter"==g.type?"cx":"x",function(t,e){return C("x",t,e,!0)}).attr("line"==g.type||"scatter"==g.type?"cy":"y",function(t,e){return C("y",t,e,!0)}),"line"==g.type||"scatter"==g.type?p.blobItem.attr("r",function(t,e){return w(t,e,!0)}):p.blobItem.attr("width",function(t,e){return k("x",t,e,!0)}).attr("height",function(t,e){return k("y",t,e,!0)}),g.colorPalette.length?p.blobItem.attr("fill",function(t,e){return p.the_color(x(t,g.colorData))}):"line"==g.type&&(g.linePointsColor||g.lineColor)&&p.blobItem.attr("fill",function(){return g.linePointsColor||g.lineColor}),p.blobItem.transition(p.duration).attr("line"==g.type||"scatter"==g.type?"cx":"x",function(t,e){return C("x",t,e)}).attr("line"==g.type||"scatter"==g.type?"cy":"y",function(t,e){return C("y",t,e)}),"line"==g.type||"scatter"==g.type?p.blobItem.transition(p.duration).attr("r",function(t,e){return w(t,e)}):p.blobItem.transition(p.duration).attr("width",function(t,e){return k("x",t,e)}).attr("height",function(t,e){return k("y",t,e)}))),g.xTicks&&g.yTicks||(p.blobText=p.blobWrap.append("text"),r.forEach(function(t){g[t+"Ticks"]||(p["blobText_"+t]=p.blobText.append("tspan").attr("class",i+"item-data-"+g[t+"Data"]).attr("dominant-baseline","middle").attr("text-anchor",function(t,e){return A(t,e)}).attr("font-size",null).text(function(e,n){return p["format_"+t](x(e,g.dataKey[g[t+"Data"]]))}).attr("x",T("x",t)).attr("y",T("y",t)),p.mLength=function(t,e){var n=0;return length=p.blobText?p.blobText.nodes()[e].getBoundingClientRect()[l(t)]:0,n=length+15})}),p.blobText.attr("class",function(t,e){var n=i+"item-text";return r.forEach(function(r){(1==g[r+"Data"]&&(parseFloat(k(r,t,e,!1))<p.mLength(r,e)||g.colorPalette.length>0&&parseFloat(k(r,t,e,!1))>=p.mLength(r,e)&&!u(p.the_color(x(t,g.colorData))))||"line"==g.type)&&(n+=" dark")}),n}).attr("transform",function(t,e){return"translate("+D("x",t,e,!0)+","+D("y",t,e,!0)+")"}).style("opacity",0),p.blobText.transition(p.duration).attr("transform",function(t,e){return"translate("+D("x",t,e)+","+D("y",t,e)+")"}).style("opacity",1)),g.colorLegend&&(p.container_legend=p.container.append("g").attr("class",i+"legend"),p.dom_color.forEach(function(t,e){p.legend=p.container_legend.append("g").attr("class",i+"legend-item"),p.legend.append("rect").attr("width","1em").attr("height","1em").attr("fill",p.the_color(t)),p.legend.append("text").text(t).attr("x","2em").attr("y","1.25em"),p.legend.attr("transform","translate(0, "+e*p.legend.nodes()[0].getBoundingClientRect().height+")")}),p.container_legend.attr("opacity","0").attr("transform","translate("+P("x")+","+P("y")+")"),p.container_legend.transition(p.duration).attr("opacity","1"))};if("text"==g.srcType||"rows"==g.srcType){var O=f.querySelector('script[type="application/json"]').innerHTML,M;if(O.isValidJSONString())K(JSON.parse(O));else console.error("Data input may not be valid. Please check and update the syntax")}else switch(g.srcPath.getFileExtension()){case"csv":e.csv(g.srcPath,function(t){return t}).then(K);break;case"tsv":e.tsv(g.srcPath,function(t){return t}).then(K);break;default:e.json(g.srcPath,function(t){return t}).then(K)}};n.dataVisualizer=f,t._1p21=n}(window,d3);