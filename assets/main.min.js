!function(t,e){"use strict";var n=n||{},r=["x","y"],a=["x","y","color","r"],o=[0,1,"color","area"],l="data-visualizer-",c=15,s=function(t,e){return e?"x"==t?"height":"width":"x"==t?"width":"height"},u=function(t){return"x"==t?"y":"x"};function f(){var t=navigator.userAgent;return t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1}String.prototype.getFileExtension=function(){return this.split(".").pop()},String.prototype.getHash=function(){var t=0,e,n;if(0===this.length)return t;for(e=0;e<this.length;e++)t=(t<<5)-t+(n=this.charCodeAt(e)),t|=0;return t},String.prototype.isValidJSONString=function(){try{JSON.parse(this)}catch(t){return!1}return!0},String.prototype.toCamelCase=function(){var t;return this.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")};var p=function(t){var e,n,r,a;return t.match(/^rgb/)?(e=(t=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],n=t[2],r=t[3]):(e=(t=+("0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&")))>>16,n=t>>8&255,r=255&t),!((a=Math.sqrt(e*e*.299+n*n*.587+r*r*.114))>170)},g=function(n,a){var c=document.querySelector(n);if(f()){var g=document.createElement("div");throw g.className=l+"wrapper fatality",g.innerHTML='Sorry, this graphic needs D3 to render the data but your browser does not support it.<br><br> Newer versions of Chrome, Edge, Firefox and Safari are recommended. <br><br>See <em><a target="_blank" rel="nofollow" href="https://d3-wiki.readthedocs.io/zh_CN/master/Home/#browser-platform-support">the official wiki</a></em> for more information',c.appendChild(g),new Error("D3 not supported")}var h={},m={width:600,height:600,margin:20,marginOffset:2,transition:2e3,delay:300,srcType:"",srcPath:"",srcKey:null,type:"bar",nameIsNum:!1,key:{0:0,1:1,color:null,area:null},format0Prepend:"",format0Append:"",format0Parameter:null,format1Prepend:"",format1Append:"",format1Parameter:null,format1Divider:1,format1Prepend:"",format1Append:"",format1Parameter:null,colorPalette:[],colorData:null,colorLegend:!1,xData:0,xAlign:"bottom",xTicks:!1,xLabel:null,xTicksAmount:null,xParameter:null,xMin:null,xMax:null,xGrid:!1,xGridIncrement:1,xPrepend:"",xAppend:"",xDivider:1,yData:1,yAlign:"left",yTicks:!1,yLabel:null,yTicksAmount:null,yParameter:null,yMin:null,yMax:null,yGrid:!1,yGridIncrement:1,yPrepend:"",yAppend:"",yDivider:1,lineStyle:"",lineWeight:1,lineColor:null,linePoints:!1,lineFill:!1,linePointsColor:null,linePointsSize:null,lineFillColor:null,lineFillOpacity:.5,lineDash:[100,0],piLabelStyle:null,piInRadius:0},y=m;for(var b in a)a.hasOwnProperty(b)&&(y[b]=a[b]);var x=function(t){return 0==t||1==t?y.xData==t?"x":"y":t},_=function(t){var e=0;return"pie"!==y.type&&(e=y.margin*(.75*y.marginOffset),y[t+"Label"]&&(e=y.margin*(1.5*y.marginOffset)),"x"==t&&0==y[u(t)+"Data"]&&(e=y.margin*(1.75*y.marginOffset),y[u(t)+"Label"]&&(e+=.5*y.marginOffset))),e},v=function(t,e,r){var a=e.toString().split(".");function i(t,e){var n=null;return n=e.length?i(t[e[0]],e.slice(1)):1==r?parseFloat(t):t}r=r||!1,a.forEach(function(t,e){""==t&&a.splice(e,1)});var o=i(t,a);return 1==r&&isNaN(o)&&console.warn(n+" data with the key source of `"+e+"` was passed as numeric but is not."),o},k=function(t){var e=[];switch(t){case"color":e=y[t+"Palette"];break;case 0:case 1:e="top"==y[u(x(t))+"Align"]||"left"==y[u(x(t))+"Align"]?[0,y[s(x(t))]]:[y[s(x(t))],0]}return e},w=function(t,n){var r=[],a=y.key[t];if(a)switch(t){case"color":case"area":var i;r=n.reduce(function(t,e){return t.includes(v(e,a))||t.push(v(e,a)),t},[]);break;case 0:case 1:var o,l;if(y.nameIsNum||1==t)r=[o=null!==y[x(t)+"Min"]?y[x(t)+"Min"]:e.min(n,function(t){return v(t,a,!0)}),l=null!==y[x(t)+"Max"]?y[x(t)+"Max"]:e.max(n,function(t){return v(t,a,!0)})];else r=n.map(function(t){return v(t,a,!1)})}return r},A=function(t,e){var n=0;return"x"==t?"x"==e?n=y[s(e)]/2:"y"==e&&(n=-y[s(e)]/2):"x"==e?n="bottom"==y[e+"Align"]?y[s(e,!0)]+(h.off_y-.125*y.margin):-(h.off_y-1.5*y.margin):"y"==e&&(n="right"==y[e+"Align"]?y[s(e,!0)]+h.off_x:-.125*h.off_x),n},P=function(t,e,n,r){var a=y[t+"Data"],i=y[u(t)+"Align"],o=20;switch(r=r||!1,y.type){case"pie":break;default:o=y.nameIsNum||1==a?r?0:"right"==i||"bottom"==i?y[s(t)]-h["the_"+a](v(e,y.key[a],!0)):h["the_"+a](v(e,y.key[a],!0)):h["the_"+a].bandwidth()}return o},D=function(t,e,n){var r=2;return"line"==y.type?n?r=0:"line"==y.type&&y.linePointsSize&&(r=y.linePointsSize):y.type,r},T=function(t,e){var n="middle";return"pie"==y.type||(0==y.yData&&(n="start"),r.forEach(function(t){0==y[u(t)+"Data"]&&"right"==y[u(t)+"Align"]&&(n="end")})),n},C=function(t,e){var n="0em";return"pie"==y.type||"y"==t&&(y.xTicks||y.yTicks||(n=1==y[e+"Data"]?".375em":"-1.625em")),n},S=function(t,e,n,r){var a=y[t+"Data"],i=0,o=function(){var e=0,r=1;return("bar"!=y.type||"top"!=y[u(t)+"Align"]&&"right"!=y[u(t)+"Align"])&&("bar"===y.type||"bottom"!=y[u(t)+"Align"]&&"right"!=y[u(t)+"Align"])||(r*=-1),0==y[u(t)+"Data"]&&(e="x"==t?15:h.mLength(t,n)/2,h.mLength(t,n)),e*=r},l=function(){var r=1,i=0;return("bar"!=y.type||"bottom"!=y[u(t)+"Align"]&&"right"!=y[u(t)+"Align"])&&("line"!=y.type||"top"!=y[u(t)+"Align"]&&"left"!=y[u(t)+"Align"])||(r=-1),("line"!==y.type&&parseFloat(P(t,e,n))<h.mLength(t,n)||"line"==y.type&&parseFloat(P(t,e,n))>=y[s(u(t))]-h.mLength(t,n))&&0!==a&&(i="x"==t&&"line"!==y.type?P(t,e,n):h.mLength(t,n)),i*=r};switch(r=r||!1,y.type){case"pie":break;default:if(0==a)i=L(t,e,n),"bar"==y.type&&(i+=P(t,e,n)/2);else switch(y[u(t)+"Align"]){case"top":i=r?L(t,e,n):P(t,e,n);break;case"right":case"bottom":i=r||"right"==y[u(t)+"Align"]&&"bar"==y.type?y[s(t)]:y[s(t)]-P(t,e,n);break;case"left":"bar"!==y.type&&(i=P(t,e,n))}i+=o()+l()}return i},L=function(t,e,n,r){var a=y[t+"Data"],i=y[u(t)+"Align"],o=0;switch(r=r||!1,y.type){case"pie":break;default:y.nameIsNum||1==a?"right"==i||"bottom"==i?o=r&&0!==a?y[s(t)]:y[s(t)]-(y[s(t)]-h["the_"+y[t+"Data"]](v(e,y.key[a],!0))):"line"!=y.type&&"scatter"!=y.type||r&&0!==a||(o=h["the_"+y[t+"Data"]](v(e,y.key[a],!0))):(o=h["the_"+y[t+"Data"]](v(e,y.key[a],!1)),"line"!=y.type&&"scatter"!=y.type||y.nameIsNum||(o+=P(t,e,n)/2))}return o},I=function(t){if(h.container_legend){var e=0,n=function(){var e=0,n=1;return"left"!=y[u(t)+"Align"]&&"top"!=y[u(t)+"Align"]||(n=-1,e=.75*h.container_legend.nodes()[0].getBoundingClientRect()[s(t)]),e*n};return"left"!=y[u(t)+"Align"]&&"top"!=y[u(t)+"Align"]||(e=y[s(t)]),e+n()}},F=function(t,r,a){a=a||!1;var i=r?"area":"line",o=0==y.xData?"x":"y",l=function(){var t="curveLinear";switch(y.lineStyle){case"step":t="curveStepAfter";break;case"curve":t="curveMonotone"+o.toUpperCase()}return t}(),c=e[i]();if("area"==i){var s={name:o,value:u(o)+1,fill:u(o)+0};"right"!=y[u(o)+"Align"]&&"bottom"!=y[u(o)+"Align"]||(s.value=u(o)+0,s.fill=u(o)+1),console.log(n,o),c[s.name](function(t,e){return L(o,t,e,a)})[s.value](function(t,e){return L(u(o),t,e,a)})[s.fill](function(t,e){return L(u(o),t,e,!0)})}else c.x(function(t,e){return L("x",t,e,a)}).y(function(t,e){return L("y",t,e,a)});return l&&c.curve(e[l]),c(t)},N=function(t){var n=e.arc().outerRadius(Math.min(y.width,y.height)).innerRadius(y.pieRadius);return function(e){return d.startAngle=i(e),n(t)}},M=function(t){var n;return e.pie().sort(null).value(function(t,e){return v(t,y.key[0])})(t)},O=function(t){var n;switch(t){case"color":n=e.scaleOrdinal().range(h["range_"+t]);break;case 0:case 1:n=y.nameIsNum||1==t?e.scaleLinear().range(h["range_"+t]):"line"==y.type?e.scalePoint().range(h["range_"+t]):e.scaleBand().range(h["range_"+t]).paddingInner(.1).paddingOuter(.1)}return n},E=function(t,n,r){if(y[t+"Ticks"]){var a=r?"grid_":"",i=y[t+"Align"];r=r||!1,y[t+"Label"]&&(h["lab_"+t]=h.container_lab.append("text").attr("class",l+"label-"+t).attr("y",function(){return A("y",t)}).attr("x",function(){return A("x",t)}).attr("font-size","1em").attr("text-anchor","middle").attr("opacity",0).text(y[t+"Label"]),"y"==t&&h["lab_"+t].attr("transform","rotate(-90)"),h["lab_"+t].transition(h.duration).attr("opacity",1)),h["rule_"+a+t]=n.append("g").attr("class",function(){var e=null;return e=r?l+"grid-"+t+" grid-increment-"+y[t+"GridIncrement"]+" tick-amount-"+y[t+"TickAmount"]:l+"axis-"+t+" "+l+"axis-align-"+i+" tick-amount"+y[t+"TickAmount"]});var o="";switch(t+" "+i){case"x bottom":o="0,"+y.height;break;case"y right":o=y.width+",0";break;default:o="0,0"}h["rule_"+a+t].attr("transform","translate("+o+")");var c="Axis "+i;if(h["axis_"+a+t]=e[c.toCamelCase()](h["the_"+y[t+"Data"]]),y[t+"Ticks"]){if(y[t+"TicksAmount"]){var f=function(){return r&&y[t+"TicksAmount"]?y[t+"TicksAmount"]*y[t+"GridIncrement"]:y[t+"TicksAmount"]};h["axis_"+a+t].ticks(f())}r?h["axis_"+a+t].tickSize(-y[s(u(t))]).tickFormat(""):h["axis_"+a+t].tickFormat(function(e,n){return h["format_"+y[t+"Data"]](e)})}}},z=function(r){var i=null;switch(h.duration=e.transition().duration(y.transition),y.type){case"bar":h.graph_item_element="rect";break;case"pie":h.graph_item_element="path";break;case"line":case"scatter":h.graph_item_element="circle"}if(i=y.srcKey?v(r,y.srcKey):r,y.nameIsNum){for(var s=[],u=0;u<i.length;u++)i[u]&&s.push(i[u]);s.sort(function(t,e){return v(t,y.key[0],!0)-v(e,y.key[0],!0)}),i=s}a.key.color||(a.key.color=y.key[0],a.colorLegend||(y.colorLegend=!1)),h.off_x=_("x"),h.off_y=_("y"),h.outerWidth=y.width+2*h.off_x,h.outerHeight=y.height+2*h.off_y,h.canvas=e.select(n).append("div").attr("class",l+"wrapper"),h.dimensionString="0 0 "+h.outerWidth+" "+h.outerHeight,h.svg=h.canvas.append("svg").attr("id",n+"-svg").attr("version","1.1").attr("x","0px").attr("y","0px").attr("class",l+"svg").attr("viewBox",h.dimensionString).attr("preserveAspectRatio","xMaxYMax meet").attr("xml:space","preserve").style("style","enable-background","new "+h.dimensionString).attr("width",h.outerWidth).attr("height",h.outerHeight),h.container=h.svg.append("g");var f=1.25,p=.75,d=h.off_x,g=h.off_y;switch(y.yAlign+" "+(y.xLabel?"has":"empty")){case"left has":h.transformX=h.off_x*f;break;case"right has":h.transformX=h.off_x*p;break;default:h.transformX=h.off_x}switch(y.xAlign+" "+(y.yLabel?"has":"empty")){case"top has":h.transformX=h.off_y*f;break;case"bottom has":h.transformX=h.off_y*p;break;default:h.transformX=h.off_y}h.container.attr("transform","translate("+d+","+g+")"),"pie"==y.type?(h.dataPi=M(i),console.log(h.dataPi)):(h.container_lab=h.container.append("g").attr("class",l+"label"),h.container_rule=h.container.append("g").attr("class",l+"axis"),(y.xGrid||y.yGrid)&&(h.container_grid=h.container.append("g").attr("class",l+"grid"))),o.forEach(function(t){if("pie"!=y.type||"color"===t)switch(h["range_"+t]=k(t),h["dom_"+t]=w(t,i),h["the_"+t]=O(t),h["the_"+t]&&h["dom_"+t]&&h["the_"+t].domain(h["dom_"+t]),h["format_"+t]="function"==typeof y[t+"Parameter"]?y[t+"Parameter"]:"string"==typeof y[t+"Parameter"]?function(n){return e.format(y[t+"Parameter"])(n)}:function(e){var n=1==y[t+"Data"]||y.nameIsNum?e/y["format"+t.toString().toUpperCase()+"Divider"]:e,r;return y["format"+t.toString().toUpperCase()+"Prepend"]+n+y["format"+t.toString().toUpperCase()+"Append"]},t){case 0:case 1:E(x(t),h.container_rule),y[x(t)+"Grid"]&&E(x(t),h.container_grid,!0);case"color":if(y.colorPalette.length)break}}),h.container_graph=h.container.insert("g").attr("class",l+"graph "+l+"type-"+y.type+" "+l+(y.colorPalette.length>0||null!==y.linePointsColor||null!==y.lineColor?"has-palette":"no-palette")+(y.xTicks||y.yTicks?"":" "+l+"item-data-no-ticks")),y.width==m.width&&y.height==m.height&&i.length>9?console.warn(n+" Width and height was not adjusted. graph elements may not fit in the canvas"):y.width<m.width&&y.height<m.height&&console.warn(n+" set canvas width and or height may be too small.\n Tip: The given height and width are not absolute and act more like aspect ratios. svgs are responsive and will shrink along with content."),("line"!=y.type||y.linePoints)&&(h.blob=h.container_graph.selectAll(h.graph_item_element).data(i,function(t){return v(t,y.key[0])})),h.dv_init=!1,document.addEventListener("scroll",function(e){var n;c.getBoundingClientRect().top<.5*t.innerHeight&&!h.dv_init&&(h.dv_init=!0,setTimeout(function(){G(i)},y.delay))},!0)},G=function(t){console.log(n,"-------------------------------------------------------------------","\n","calculated",h,"\n","data",t,"\n","args",y,"\n","\n","x","\n","domain",h["dom_"+y.xData],"\n","range",h["range_"+y.xData],"\n","\n","y","\n","domain",h["dom_"+y.yData],"\n","range",h["range_"+y.yData],"\n","\n"),"pie"==y.type||(r.forEach(function(t){y[t+"Ticks"]&&(h["rule_"+t].transition(y.delay).call(h["axis_"+t]).attr("font-family","inherit").attr("font-size",null),y[t+"Grid"]&&(h["rule_grid_"+t].call(h["axis_grid_"+t]),h["rule_grid_"+t].selectAll(".tick").attr("class",function(e,n){var r="grid";return h["rule_"+t].selectAll(".tick").each(function(t){t==e&&(r+=" tick-aligned")}),r})))}),"line"==y.type&&(y.lineFill&&(h.fill=h.container_graph.append("path").attr("class",l+"fill"+(null!==y.lineFillColor?" has-color":" no-color")).attr("fill-opacity",0).attr("d",function(){return F(t,!0,!0)}),(y.lineFillColor||y.lineColor)&&h.fill.attr("fill",y.lineFillColor||y.lineColor),h.fill.transition(h.duration).attr("fill-opacity",y.lineFillOpacity).attr("d",function(){return F(t,!0)})),h.line=h.container_graph.append("path").attr("class",l+"line"+(null!==y.lineColor?" has-color":" no-color")).attr("fill","none").attr("stroke-width",y.lineWeight).attr("stroke-linejoin","round").attr("stroke-opacity",0).attr("d",function(){return F(t,!1,!0)}).attr("stroke-dasharray","0,0"),y.lineColor&&h.line.attr("stroke",y.lineColor),h.line.transition(h.duration).attr("d",function(){return F(t,!1)}).attr("stroke-dasharray",y.lineDash).attr("stroke-opacity",1))),("line"!=y.type||y.linePoints)&&(h.blob.exit().transition(h.duration).attr("height",0).remove(),h.blobWrap=h.blob.enter().append("g").attr("class",function(t){return l+"item "+l+v(t,y.key[0])}),h.blobItem=h.blobWrap.append(h.graph_item_element).attr("line"==y.type||"scatter"==y.type?"cx":"x",function(t,e){return L("x",t,e,!0)}).attr("line"==y.type||"scatter"==y.type?"cy":"y",function(t,e){return L("y",t,e,!0)}),"line"==y.type||"scatter"==y.type?h.blobItem.attr("r",function(t,e){return D(t,e,!0)}):h.blobItem.attr("width",function(t,e){return P("x",t,e,!0)}).attr("height",function(t,e){return P("y",t,e,!0)}),y.colorPalette.length?h.blobItem.attr("fill",function(t,e){return h.the_color(v(t,y.key.color))}):"line"==y.type&&(y.linePointsColor||y.lineColor)&&h.blobItem.attr("fill",function(){return y.linePointsColor||y.lineColor}),h.blobItem.transition(h.duration).attr("line"==y.type||"scatter"==y.type?"cx":"x",function(t,e){return L("x",t,e)}).attr("line"==y.type||"scatter"==y.type?"cy":"y",function(t,e){return L("y",t,e)}),"line"==y.type||"scatter"==y.type?h.blobItem.transition(h.duration).attr("r",function(t,e){return D(t,e)}):h.blobItem.transition(h.duration).attr("width",function(t,e){return P("x",t,e)}).attr("height",function(t,e){return P("y",t,e)})),y.xTicks&&y.yTicks||(h.blobText=h.blobWrap.append("text"),r.forEach(function(t){y[t+"Ticks"]||(h["blobText_"+t]=h.blobText.append("tspan").attr("class",l+"item-data-"+y[t+"Data"]).attr("dominant-baseline","middle").attr("text-anchor",function(t,e){return T(t,e)}).attr("font-size",null).text(function(e,n){return console.log(y[t+"Data"]),h["format_"+y[t+"Data"]](v(e,y.key[y[t+"Data"]]))}).attr("x",C("x",t)).attr("y",C("y",t)),h.mLength=function(t,e){var n=0;return length=h.blobText?h.blobText.nodes()[e].getBoundingClientRect()[s(t)]:0,n=length+15})}),h.blobText.attr("class",function(t,e){var n=l+"item-text";return r.forEach(function(r){(1==y[r+"Data"]&&(parseFloat(P(r,t,e,!1))<h.mLength(r,e)||y.colorPalette.length>0&&parseFloat(P(r,t,e,!1))>=h.mLength(r,e)&&!p(h.the_color(v(t,y.key.color))))||"line"==y.type)&&(n+=" dark")}),n}).attr("transform",function(t,e){return"translate("+S("x",t,e,!0)+","+S("y",t,e,!0)+")"}).style("opacity",0),h.blobText.transition(h.duration).attr("transform",function(t,e){return"translate("+S("x",t,e)+","+S("y",t,e)+")"}).style("opacity",1)),y.colorLegend&&(h.container_legend=h.container.append("g").attr("class",l+"legend"),h.dom_color.forEach(function(t,e){h.legend=h.container_legend.append("g").attr("class",l+"legend-item"),h.legend.append("rect").attr("width","1em").attr("height","1em").attr("fill",h.the_color(t)),h.legend.append("text").text(t).attr("x","2em").attr("y","1.25em"),h.legend.attr("transform","translate(0, "+e*h.legend.nodes()[0].getBoundingClientRect().height+")")}),h.container_legend.attr("opacity","0").attr("transform","translate("+I("x")+","+I("y")+")"),h.container_legend.transition(h.duration).attr("opacity","1"))};if("text"==y.srcType||"rows"==y.srcType){var R=c.querySelector('script[type="application/json"]').innerHTML,W;if(R.isValidJSONString())z(JSON.parse(R));else console.error("Data input may not be valid. Please check and update the syntax")}else switch(y.srcPath.getFileExtension()){case"csv":e.csv(y.srcPath,function(t){return t}).then(z);break;case"tsv":e.tsv(y.srcPath,function(t){return t}).then(z);break;default:e.json(y.srcPath,function(t){return t}).then(z)}};n.dataVisualizer=g,t._1p21=n}(window,d3);