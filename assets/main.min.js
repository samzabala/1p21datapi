"use strict";!function(t,e){var n=n||{},a=["x","y","color","area","r"],r="data-visualizer-",i=function(t,e){return e?"x"==t?"height":"width":"x"==t?"width":"height"},o=function(t){return"x"==t?"y":"x"};String.prototype.getFileExtension=function(){return this.split(".").pop()},String.prototype.getHash=function(){var t,e=0;if(0===this.length)return e;for(t=0;t<this.length;t++)e=(e<<5)-e+this.charCodeAt(t),e|=0;return e},String.prototype.isValidJSONString=function(){try{JSON.parse(this)}catch(t){return!1}return!0},String.prototype.toCamelCase=function(){return this.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")};n.dataVisualizer=function(n,l){var s=document.querySelector(n),c={},u={width:600,height:400,margin:20,marginOffset:2,transition:2e3,delay:300,type:"bar",dataKey:[0,1],nameIsNum:!1,srcType:"",srcPath:"",srcKey:null,colorPalette:[],colorData:null,xData:0,xAlign:"bottom",xTicks:!1,xLabel:null,xTicksAmount:null,xTicksParameter:null,xMin:null,xMax:null,xGrid:!1,xGridIncrement:1,xPrepend:"",xAppend:"",xDivider:1,yData:1,yAlign:"left",yTicks:!1,yLabel:null,yTicksAmount:null,yTicksParameter:null,yMin:null,yMax:null,yGrid:!1,yGridIncrement:1,yPrepend:"",yAppend:"",yDivider:1,lineStyle:"",lineWeight:1,lineColor:null,linePoints:!1,lineFill:!1,linePointsColor:null,linePointsSize:null,lineFillColor:null,lineFillOpacity:.5,lineFillInvert:"x",lineDash:[100,0],areaKey:""},f=u;for(var p in l)l.hasOwnProperty(p)&&(f[p]=l[p]);c.mLength=f.xTicks||f.yTicks?70:120;var y=function(t){var e=0;return"pie"!==f.type&&(e=f.margin*(.75*f.marginOffset),f[t+"Label"]&&(e=f.margin*f.marginOffset),"x"==t&&0==f[o(t)+"Data"]&&(e=f.margin*(1.75*f.marginOffset),f[o(t)+"Label"]&&(e+=.5*f.marginOffset))),e},d=function(t,e,n){var a=e.toString().split(".");return a.forEach(function(t,e){""==t&&a.splice(e,1)}),function t(e,a){return a.length?t(e[a[0]],a.slice(1)):n?parseFloat(e):e}(t,a)},g=function(t,n){var a=f[t+"Data"],r=[];if(null!==a){switch(t){case"color":var i=f.colorData||f.dataKey[0];r=n.reduce(function(t,e){return t.includes(d(e,i))||t.push(d(e,i)),t},[]);break;case"x":case"y":r=f.nameIsNum||1==a?[null!==f[t+"Min"]?f[t+"Min"]:e.min(n,function(t){return d(t,f.dataKey[a],!0)}),null!==f[t+"Max"]?f[t+"Max"]:e.max(n,function(t){return d(t,f.dataKey[a],!0)})]:n.map(function(t){return d(t,f.dataKey[a],!1)})}return r}},h=function(t,e){var n=0;return"x"==t?"x"==e?n=f[i(e)]/2:"y"==e&&(n=-f[i(e)]/2):"x"==e?n="bottom"==f[e+"Align"]?f[i(e,!0)]+(c.off_y-.125*f.margin):-(c.off_y-1.5*f.margin):"y"==e&&(n="right"==f[e+"Align"]?f[i(e,!0)]+c.off_x:-.125*c.off_x),n},m=function(t,e,n,a){var r=f[t+"Data"],l=f.dataKey[r],s=f[o(t)+"Align"],u=20;switch(a=a||!1,f.type){case"pie":break;default:u=f.nameIsNum||1==r?a?0:"right"==s||"bottom"==s?f[i(t)]-c["the_"+t](d(e,l,l)):c["the_"+t](d(e,l,l)):c["the_"+t].bandwidth()}return u},x=function(t,e,n){var a=2;return n?a=0:"line"==f.type&&f.linePointsSize&&(a=f.linePointsSize),a},b=function(t,e,n,a,r){var i=0;return r=r||!1,"pie"==f.type||(!f.xTicks&&f.yTicks||f.xTicks&&!f.yTicks?1==f[t+"Data"]&&(i="top"==f.xAlign?parseFloat(m("y",n,0,!1))>c.mLength||r&&parseFloat(m("y",n,0,!1))<c.mLength?"-1em":"2em":"1em"):"x"==t?1==f[t+"Data"]&&(i="10"):i=0==f[o(t)+"Data"]?"bottom"==f[o(t)+"Align"]?parseFloat(m("y",n,0,!1))>c.mLength||r&&parseFloat(m("y",n,0,!1))<c.mLength?"1.5em":"-2.5em":n[f.dataKey[f[t+"Data"]]]!==n[f.dataKey[f[e+"Data"]]]?"-2em":"-1.75em":n[f.dataKey[f[t+"Data"]]]!==n[f.dataKey[f[e+"Data"]]]?"-.25em":"1.375em"),i},v=function(t,e,n,a){var r=f[t+"Data"],l=0;switch(a=a||!1,f.type){case"pie":break;default:0==r?(l=k(t,e,n)+m(t,e)/2,"line"!=f.type&&"scatter"!=f.type||(l-=m(t,e)/2)):"bottom"==f[o(t)+"Align"]||"right"==f[o(t)+"Align"]?l=a?f[i(t)]-(f.xTicks||f.yTicks?30:65):f[i(t)]-m(t,e):"top"==f[o(t)+"Align"]&&(a?"line"!==f.type&&"scatter"!==f.type&&(0!==f[o(t)+"Data"]?l=f[i(t)]-m(t,e):l+=f.xTicks||f.yTicks?30:c.mLength):l=m(t,e))}return l},k=function(t,e,n,a){var r=f[t+"Data"],l=f.dataKey[r],s=f[o(t)+"Align"],u=0;switch(a=a||!1,f.type){case"pie":break;default:f.nameIsNum||1==r?"right"==s||"bottom"==s?u=a?f[i(t)]:f[i(t)]-(f[i(t)]-c["the_"+t](d(e,l,!0))):"line"!=f.type&&"scatter"!=f.type||a&&0!==r||(u=c["the_"+t](d(e,l,!0))):(u=c["the_"+t](d(e,l,!1)),"line"!=f.type&&"scatter"!=f.type||f.nameIsNum||(u+=m(t,e)/2))}return u},_=function(t,n,a){a=a||!1;var r=n?"area":"line",i=0==f.xData?"x":"y",l=e[r]();if("area"==r){var s={name:i,value:o(i)+1,fill:o(i)+0};(!f.lineFillInvert&&("right"==f[i+"Align"]||"bottom"==f[i+"Align"])||f.lineFillInvert&&"right"!=f[i+"Align"]&&"bottom"!=f[i+"Align"])&&(s.value=o(i)+0,s.fill=o(i)+1),l[s.name](function(t,e){return k(i,t,e,a)})[s.value](function(t,e){return k(o(i),t,e,a)})[s.fill](function(t,e){return k(o(i),t,e,!0)})}else l.x(function(t,e){return k("x",t,e,a)}).y(function(t,e){return k("y",t,e,a)});return l(t)},T=function(t){var n,a=f[t+"Data"];switch(t){case"color":n=e.scaleOrdinal().range(c["range_"+t]);break;case"x":case"y":n=f.nameIsNum||1==a?e.scaleLinear().range(c["range_"+t]):e.scaleBand().range(c["range_"+t]).paddingInner(.1).paddingOuter(.1)}return n},A=function(t,a,o){if(f[t+"Ticks"]){var l=o?"grid_":"";f[t+"Label"]&&(c["lab_"+t]=c.labels.append("text").attr("class",r+"label-"+t).attr("y",function(){return h("y",t)}).attr("x",function(){return h("x",t)}).attr("font-size","1em").attr("text-anchor","middle").text(f[t+"Label"]),"y"==t&&c["lab_"+t].attr("transform","rotate(-90)")),c["rule_"+l+t]=function(t,e,n){var a=e.append("g").attr("class",function(){return n?r+"grid-"+t+" ":r+"axis-"+t+" "+r+"axis-align-"+f[t+"Align"]}),i="";switch(t+" "+f[t+"Align"]){case"x bottom":i="0,"+f.height;break;case"y right":i=f.width+",0";break;default:i="0,0"}return a.attr("transform","translate("+i+")"),a}(t,a,o),c["axis_"+l+t]=function(t,a){var r,o="Axis "+f[t+"Align"];if(a=a||!1,r=e[o.toCamelCase()](c["the_"+t]),f.hasOwnProperty(t+"Ticks")){if(f.hasOwnProperty(t+"TicksAmount")){var l=function(){return a&&f[t+"TicksAmount"]?f[t+"TicksAmount"]/f[t+"GridIncrement"]:f[t+"TicksAmount"]};console.log(n,t,a,t+"GridIncrement",l()),r.ticks(l())}a?r.tickSize(-f[i(t)]).tickFormat(""):f.hasOwnProperty(t+"TicksFormat")&&r.tickFormat(c["format_"+t])}return r}(t,o)}},w=function(l,c){var p=null;switch(c.duration=e.transition().duration(f.transition),f.type){case"bar":c.graphItem="rect";break;case"line":case"scatter":c.graphItem="circle"}if(p=f.srcKey?d(l,f.srcKey):l,f.nameIsNum){var h=[];for(var m in p)h.push(p[m]);h.sort(function(t,e){return d(t,f.dataKey[0],!0)-d(e,f.dataKey[0],!0)}),p=h}c.off_x=y("x"),c.off_y=y("y"),c.outerWidth=f.width+2*c.off_x,c.outerHeight=f.height+2*c.off_y,c.canvas=e.select(n).append("div").attr("class",r+"wrapper"),c.dimensionString="0 0 "+c.outerWidth+" "+c.outerHeight,c.svg=c.canvas.append("svg").attr("id",n+"-svg").attr("class",r+"svg").attr("viewBox",c.dimensionString).attr("preserveAspectRatio","xMinYMin meet").style("style","enable-background","new "+c.dimensionString).attr("width",c.outerWidth).attr("height",c.outerHeight),c.container=c.svg.append("g"),c.containerTransform=null;var x=1.25,b=.75,v=c.off_x,k=c.off_y;switch(f.yAlign+" "+(""==f.xLabel?"empty":"has")){case"left has":c.transformX=c.off_x*x;break;case"right has":c.transformX=c.off_x*b;break;default:c.transformX=c.off_x}switch(f.xAlign+" "+(""==f.yLabel?"empty":"has")){case"top has":c.transformX=c.off_y*x;break;case"bottom has":c.transformX=c.off_y*b;break;default:c.transformX=c.off_y}c.container.attr("transform","translate("+v+","+k+")"),"pie"==f.type||(c.labels=c.container.append("g").attr("class",r+"labels"),c.rule=c.container.append("g").attr("class",r+"axis"),c.grid=c.container.append("g").attr("class",r+"grid"),a.forEach(function(t){c["range_"+t]=function(t){var e=[];switch(t){case"color":e=f[t+"Palette"];break;case"x":case"y":e="top"==f[o(t)+"Align"]||"left"==f[o(t)+"Align"]?[0,f[i(t)]]:[f[i(t)],0]}return e}(t),c["the_"+t]=T(t),"x"!=t&&"y"!=t||(A(t,c.rule),c["format_"+t]=f[t+"Parameter"]||function(t){var e=1==f[axisString+"Data"]?t/f[axisString+"Divider"]:t;return f[axisString+"Prepend"]+e+f[axisString+"Append"]},c["dom_"+t]=g(t,p),c["the_"+t].domain(c["dom_"+t]),f[t+"Ticks"]&&(c["rule_"+t].transition(f.delay).call(c["axis_"+t]).attr("font-family","inherit").attr("font-size",null),f[t+"Grid"]&&(A(t,c.grid,!0),c["rule_grid_"+t].call(c["axis_grid_"+t]))))}),c.graph=c.container.insert("g",":first-child").attr("class",r+"graph "+r+(f.colorPalette.length>0||null!==f.linePointsColor||null!==f.lineColor?"has-palette":"no-palette")),p.length>9&&f.width==u.width&&f.height==u.height&&console.log(n+" Width and height was not adjusted. graph elements may not fit in the canvas"),("line"!=f.type||f.linePoints)&&(c.blob=c.graph.selectAll(c.graphItem).data(p,function(t){return t[f.dataKey[f.xData]]})),"line"==f.type&&(f.lineFill&&(c.fill=c.graph.append("path").attr("class",r+"fill").attr("fill-opacity",0).attr("d",function(){return _(p,!0,!0)}),(f.lineFillColor||f.lineColor)&&c.fill.attr("fill",f.lineFillColor||f.lineColor)),c.line=c.graph.append("path").attr("class",r+"line").attr("fill","none").attr("stroke-width",f.lineWeight).attr("stroke-linejoin","round").attr("stroke-opacity",0).attr("d",function(){return _(p,!1,!0)}).attr("stroke-dasharray","0,0"),f.lineColor&&c.line.attr("stroke",f.lineColor)),f.colorPalette.length>0&&(c.dom_color=g("color",p))),c.dv_init=!1,document.addEventListener("scroll",function(e){s.getBoundingClientRect().y<.5*t.innerHeight&&!c.dv_init&&(c.dv_init=!0,setTimeout(function(){P(c,p)},f.delay))},!0)},P=function(t,e){console.log(n,"-------------------------------------------------------------------"),console.log("calculated",t),console.log("args",f),console.log("x"),console.log("domain",t.dom_x),console.log("range",t.range_x),console.log("----------------"),console.log("y"),console.log("domain",t.dom_y),console.log("range",t.range_y),"pie"==f.type||(("line"!=f.type||f.linePoints)&&(t.blob.exit().transition(t.duration).attr("height",0).remove(),t.blobWrap=t.blob.enter().append("g").attr("class",r+"item"),t.blobItem=t.blobWrap.append(t.graphItem).attr("line"==f.type||"scatter"==f.type?"cx":"x",function(t,e){return k("x",t,e,!0)}).attr("line"==f.type||"scatter"==f.type?"cy":"y",function(t,e){return k("y",t,e,!0)}),"line"==f.type||"scatter"==f.type?t.blobItem.attr("r",function(t,e){return x(0,0,!0)}):t.blobItem.attr("width",function(t,e){return m("x",t,0,!0)}).attr("height",function(t,e){return m("y",t,0,!0)}),f.colorPalette.length?t.blobItem.attr("fill",function(e,n){return t.the_color(e[f.colorData])}):"line"==f.type&&(f.linePointsColor||f.lineColor)&&t.blobItem.attr("fill",function(){return f.linePointsColor||f.lineColor}),t.blobItem.transition(t.duration).attr("line"==f.type||"scatter"==f.type?"cx":"x",function(t,e){return k("x",t,e)}).attr("line"==f.type||"scatter"==f.type?"cy":"y",function(t,e){return k("y",t,e)}),"line"==f.type||"scatter"==f.type?t.blobItem.transition(t.duration).attr("r",function(t,e){return x()}):t.blobItem.transition(t.duration).attr("width",function(t,e){return m("x",t)}).attr("height",function(t,e){return m("y",t)})),"line"==f.type&&(f.lineFill&&t.fill.transition(t.duration).attr("fill-opacity",f.lineFillOpacity).attr("d",function(){return _(e,!0)}),t.line.transition(t.duration).attr("d",function(){return _(e,!1)}).attr("stroke-dasharray",f.lineDash).attr("stroke-opacity",1))),f.xTicks&&f.yTicks||(t.blobText=t.blobWrap.append("g").attr("class",r+"item-text"+(f.xTicks||f.yTicks?"":" "+r+"item-data-no-ticks")).attr("transform",function(t,e){return"translate("+v("x",t,e,!0)+","+v("y",t,e,!0)+")"}).style("opacity",0),t.blobText.transition(t.duration).attr("transform",function(t,e){return"translate("+v("x",t,e)+","+v("y",t,e)+")"}).style("opacity",1),["x","y"].forEach(function(e){f[e+"Ticks"]||(t["blobText"+e]=t.blobText.append("text").attr("class",function(n,a){var i,o,l,s,c=r+"item-data-"+f[e+"Data"];return(parseFloat(m("y",n,0,!1))<t.mLength||f.colorPalette.length>0&&parseFloat(m("y",n,0,!1))>t.mLength&&((i=t.the_color(n[f.colorData])).match(/^rgb/)?(o=(i=i.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],l=i[2],s=i[3]):(o=(i=+("0x"+i.slice(1).replace(i.length<5&&/./g,"$&$&")))>>16,l=i>>8&255,s=255&i),Math.sqrt(o*o*.299+l*l*.587+s*s*.114)>170)||"line"==f.type)&&(c+=" item-text-dark color-palette-"+f.colorPalette.length),c}).attr("dominant-baseline",function(t,e){return n="middle",0==f.xData&&(n="bottom"==f.xAlign?"hanging":"auto"),n;var n}).attr("text-anchor",function(t,e){return n="middle","pie"==f.type||0==f.yData&&(n="start"),n;var n}).attr("font-size",null).text(function(t,n){return d(t,f.dataKey[f[e+"Data"]])}).attr("x",function(t,n){return b("x",e,t,0,!0)}).attr("y",function(t,n){return b("y",e,t,0,!0)}),t["blobText"+e].transition(t.duration).attr("x",function(t,n){return b("x",e,t)}).attr("y",function(t,n){return b("y",e,t)}))}))};switch(f.srcPath.getFileExtension()){case"csv":e.csv(f.srcPath).then(function(t){w(t,c)});break;case"tsv":e.tsv(f.srcPath).then(function(t){w(t,c)});break;case"json":e.json(f.srcPath).then(function(t){w(t,c)});break;default:if(f.srcPath.getHash()){var D=s.querySelector('script[type="application/json"]').innerHTML;if(D.isValidJSONString()){var I=JSON.parse(D);w(I,c)}else"text"==f.srcType?console.error("Data input may not be valid. Please check and update the syntax"):console.error("The data source is not a supported format. Please make sure data is linked either as a json,csv, tsv or direct input in the fields")}}},t._1p21=n}(window,d3);