!function(t,e){"use strict";var n=n||{},r=["x","y"],a=[0,1,"color","area"],i="data-visualizer-",o=function(t,e){return e?"x"==t?"height":"width":"x"==t?"width":"height"},l=function(t){return"x"==t?"y":"x"};String.prototype.getFileExtension=function(){return this.split(".").pop()},String.prototype.getHash=function(){var t,e=0;if(0===this.length)return e;for(t=0;t<this.length;t++)e=(e<<5)-e+this.charCodeAt(t),e|=0;return e},String.prototype.isValidJSONString=function(){try{JSON.parse(this)}catch(t){return!1}return!0},String.prototype.toCamelCase=function(){return this.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0==e?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")};n.dataVisualizer=function(n,c){var s,u=document.querySelector(n);if((s=navigator.userAgent).indexOf("MSIE ")>-1||s.indexOf("Trident/")>-1){var p=document.createElement("div");throw p.className=i+"wrapper fatality",p.innerHTML='Sorry, this graphic needs D3 to render the data but your browser does not support it.<br><br> Newer versions of Chrome, Edge, Firefox and Safari are recommended. <br><br>See <em><a target="_blank" rel="nofollow" href="https://d3-wiki.readthedocs.io/zh_CN/master/Home/#browser-platform-support">the official wiki</a></em> for more information',u.appendChild(p),new Error("D3 not supported")}var f={},d={width:600,height:600,margin:20,marginOffset:2,transition:1500,delay:300,srcType:"",srcPath:"",srcKey:null,type:"bar",nameIsNum:!1,key:{0:0,1:1,color:null,area:null},format0Prepend:"",format0Append:"",format0Parameter:null,format0Divider:1,format1Prepend:"",format1Append:"",format1Parameter:null,format1Divider:1,format1Prepend:"",format1Append:"",format1Parameter:null,colorPalette:[],colorData:null,colorLegend:!1,xData:0,xAlign:"bottom",xTicks:!1,xLabel:null,xTicksAmount:null,xParameter:null,xMin:null,xMax:null,xGrid:!1,xGridIncrement:1,xPrepend:"",xAppend:"",xDivider:1,yData:1,yAlign:"left",yTicks:!1,yLabel:null,yTicksAmount:null,yParameter:null,yMin:null,yMax:null,yGrid:!1,yGridIncrement:1,yPrepend:"",yAppend:"",yDivider:1,lineStyle:"",lineWeight:1,lineColor:null,linePoints:!1,lineFill:!1,linePointsColor:null,linePointsSize:null,lineFillColor:null,lineFillOpacity:.5,lineDash:[100,0],piLabelStyle:null,piInRadius:0},g=d;for(var h in c)c.hasOwnProperty(h)&&(g[h]=c[h]);var m=function(t){return 0==t||1==t?g.xData==t?"x":"y":t},y=function(t){var e=0;return"pie"!==g.type&&(e=g.margin*(.75*g.marginOffset),g[t+"Label"]&&(e=g.margin*(1.5*g.marginOffset)),"x"==t&&0==g[l(t)+"Data"]&&(e=g.margin*(1.75*g.marginOffset),g[l(t)+"Label"]&&(e+=.5*g.marginOffset))),e},b=function(t,e,r){var a=e.toString().split(".");r=r||!1,a.forEach(function(t,e){""==t&&a.splice(e,1)});var i=function t(e,n){return n.length?t(e[n[0]],n.slice(1)):1==r?parseFloat(e):e}(t,a);return 1==r&&isNaN(i)&&console.warn(n+" data with the key source of `"+e+"` was passed as numeric but is not."),i},x=function(t,e){var n=0;return"x"==t?"x"==e?n=g[o(e)]/2:"y"==e&&(n=-g[o(e)]/2):"x"==e?n="bottom"==g[e+"Align"]?g[o(e,!0)]+(f.off_y-.125*g.margin):-(f.off_y-1.5*g.margin):"y"==e&&(n="right"==g[e+"Align"]?g[o(e,!0)]+f.off_x:-.125*f.off_x),n},_=function(t,e,n,r){var a=g[t+"Data"],i=g[l(t)+"Align"],c=20;switch(r=r||!1,g.type){case"pie":break;default:c=g.nameIsNum||1==a?r?0:"right"==i||"bottom"==i?g[o(t)]-f["the_"+a](b(e,g.key[a],!0)):f["the_"+a](b(e,g.key[a],!0)):f["the_"+a].bandwidth()}return c},v=function(t,e,n){var r=2;return"line"==g.type?n?r=0:"line"==g.type&&g.linePointsSize&&(r=g.linePointsSize):g.type,r},k=function(t,e){var n="0em";return"pie"==g.type||"y"==t&&(g.xTicks||g.yTicks||(n=1==e?".375em":"-1.5em")),n},w=function(t,e,n,r){var a,i,c=g[t+"Data"],s=0;switch(r=r||!1,g.type){case"pie":break;default:if(0==c)s=A(t,e,n),"bar"==g.type&&(s+=_(t,e)/2);else switch(g[l(t)+"Align"]){case"top":s=r?A(t,e,n):_(t,e);break;case"right":case"bottom":s=r||"right"==g[l(t)+"Align"]&&"bar"==g.type?g[o(t)]:g[o(t)]-_(t,e);break;case"left":"bar"!==g.type&&(s=_(t,e))}s+=(a=0,i=1,("bar"!=g.type||"top"!=g[l(t)+"Align"]&&"right"!=g[l(t)+"Align"])&&("bar"===g.type||"bottom"!=g[l(t)+"Align"]&&"right"!=g[l(t)+"Align"])||(i*=-1),0==g[l(t)+"Data"]&&(a="x"==t?15:f.mLength(t,n)/2,f.mLength(t,n)),(a*=i)+function(){var r=1,a=0;return("bar"!=g.type||"bottom"!=g[l(t)+"Align"]&&"right"!=g[l(t)+"Align"])&&("line"!=g.type||"top"!=g[l(t)+"Align"]&&"left"!=g[l(t)+"Align"])||(r=-1),("line"!==g.type&&parseFloat(_(t,e))<f.mLength(t,n)||"line"==g.type&&parseFloat(_(t,e))>=g[o(l(t))]-f.mLength(t,n))&&0!==c&&(a="x"==t&&"line"!==g.type?_(t,e):f.mLength(t,n)),a*=r}())}return s},A=function(t,e,n,r){var a=g[t+"Data"],i=g[l(t)+"Align"],c=0;switch(r=r||!1,g.type){case"pie":break;default:g.nameIsNum||1==a?"right"==i||"bottom"==i?c=r&&0!==a?g[o(t)]:g[o(t)]-(g[o(t)]-f["the_"+g[t+"Data"]](b(e,g.key[a],!0))):"line"!=g.type&&"scatter"!=g.type||r&&0!==a||(c=f["the_"+g[t+"Data"]](b(e,g.key[a],!0))):(c=f["the_"+g[t+"Data"]](b(e,g.key[a],!1)),"line"!=g.type&&"scatter"!=g.type||g.nameIsNum||(c+=_(t,e)/2))}return c},P=function(t){if(f.container_legend){var e=0;return"left"!=g[l(t)+"Align"]&&"top"!=g[l(t)+"Align"]||(e=g[o(t)]),e+(n=0,r=1,"left"!=g[l(t)+"Align"]&&"top"!=g[l(t)+"Align"]||(r=-1,n=f.container_legend.nodes()[0].getBoundingClientRect()[o(t)]+15),n*r)}var n,r},T=function(t,n){var r=n?"area":"line",a=0==g.xData?"x":"y",i=function(){var t="curveLinear";switch(g.lineStyle){case"step":t="curveStepAfter";break;case"curve":t="curveMonotone"+a.toUpperCase()}return t}(),o={};if(o.start=e[r](),o.end=e[r](),"area"==r){var c={name:a,value:l(a)+1,fill:l(a)+0};"right"!=g[l(a)+"Align"]&&"bottom"!=g[l(a)+"Align"]||(c.value=l(a)+0,c.fill=l(a)+1),o.start[c.name](function(t,e){return A(a,t,e,!0)})[c.value](function(t,e){return A(l(a),t,e,!0)})[c.fill](function(t,e){return A(l(a),t,e,!0)}),o.end[c.name](function(t,e){return A(a,t,e,!1)})[c.value](function(t,e){return A(l(a),t,e,!1)})[c.fill](function(t,e){return A(l(a),t,e,!0)})}else o.start.x(function(t,e){return A("x",t,e,!0)}).y(function(t,e){return A("y",t,e,!0)}),o.end.x(function(t,e){return A("x",t,e,!1)}).y(function(t,e){return A("y",t,e,!1)});i&&(o.start.curve(e[i]),o.end.curve(e[i]));var s=e.interpolate(o.start(t),o.end(t));return function(t){return s(t)}},C=function(t){return e.pie().sort(null).value(function(t,e){return b(t,g.key[1],!0)})(t)},D=function(t,n,r){if(g[t+"Ticks"]){var a=r?"grid_":"",c=g[t+"Align"];r=r||!1,g[t+"Label"]&&(f["lab_"+t]=f.container_lab.append("text").attr("class",i+"label-"+t).attr("y",function(){return x("y",t)}).attr("x",function(){return x("x",t)}).attr("font-size","1em").attr("text-anchor","middle").attr("opacity",0).text(g[t+"Label"]),"y"==t&&f["lab_"+t].attr("transform","rotate(-90)"),f["lab_"+t].transition(f.duration).attr("opacity",1)),f["rule_"+a+t]=n.append("g").attr("class",function(){return r?i+"grid-"+t+" grid-increment-"+g[t+"GridIncrement"]+" tick-amount-"+g[t+"TickAmount"]:i+"axis-"+t+" "+i+"axis-align-"+c+" tick-amount"+g[t+"TickAmount"]});var s="";switch(t+" "+c){case"x bottom":s="0,"+g.height;break;case"y right":s=g.width+",0";break;default:s="0,0"}f["rule_"+a+t].attr("transform","translate("+s+")");var u="Axis "+c;f["axis_"+a+t]=e[u.toCamelCase()](f["the_"+g[t+"Data"]]),g[t+"Ticks"]&&(g[t+"TicksAmount"]&&f["axis_"+a+t].ticks(r&&g[t+"TicksAmount"]?g[t+"TicksAmount"]*g[t+"GridIncrement"]:g[t+"TicksAmount"]),r?f["axis_"+a+t].tickSize(-g[o(l(t))]).tickFormat(""):f["axis_"+a+t].tickFormat(function(e,n){return f["format_"+g[t+"Data"]](e)}))}},L=function(r){var s=null;switch(g.type){case"bar":f.graph_item_element="rect";break;case"pie":f.graph_item_element="path";break;case"line":case"scatter":f.graph_item_element="circle"}if(s=g.srcKey?b(r,g.srcKey):r,g.nameIsNum){for(var p=[],h=0;h<s.length;h++)s[h]&&p.push(s[h]);p.sort(function(t,e){return b(t,g.key[0],!0)-b(e,g.key[0],!0)}),s=p}c.key.color||(c.key.color=g.key[0],c.colorLegend||(g.colorLegend=!1)),f.off_x=y("x"),f.off_y=y("y"),f.outerWidth=g.width+2*f.off_x,f.outerHeight=g.height+2*f.off_y,f.canvas=e.select(n).append("div").attr("class",i+"wrapper");var x="0 0 "+f.outerWidth+" "+f.outerHeight;f.svg=f.canvas.append("svg").attr("id",n+"-svg").attr("version","1.1").attr("x","0px").attr("y","0px").attr("class",i+"svg "+i+"type-"+g.type+" "+i+(g.colorPalette.length>0||null!==g.linePointsColor||null!==g.lineColor?"has-palette":"no-palette")+(g.xTicks||g.yTicks?"":" "+i+"no-ticks")).attr("viewBox",x).attr("preserveAspectRatio","xMaxYMax meet").attr("xml:space","preserve").style("style","enable-background","new "+x).attr("width",f.outerWidth).attr("height",f.outerHeight),f.duration=f.svg.transition().duration(g.transition).ease(e.easeLinear),f.container=f.svg.append("g");var _=1.25,v=.75,k=f.off_x,w=f.off_y;switch(g.yAlign+" "+(g.xLabel?"has":"empty")){case"left has":f.transformX=f.off_x*_;break;case"right has":f.transformX=f.off_x*v;break;default:f.transformX=f.off_x}switch(g.xAlign+" "+(g.yLabel?"has":"empty")){case"top has":f.transformX=f.off_y*_;break;case"bottom has":f.transformX=f.off_y*v;break;default:f.transformX=f.off_y}f.container.attr("transform","translate("+k+","+w+")"),"pie"==g.type?console.log(C(s)):(f.container_lab=f.container.append("g").attr("class",i+"label"),f.container_rule=f.container.append("g").attr("class",i+"axis"),(g.xGrid||g.yGrid)&&(f.container_grid=f.container.append("g").attr("class",i+"grid"))),a.forEach(function(t){if("pie"!=g.type||"color"===t)switch(f["range_"+t]=function(t){var e=[];switch(t){case"color":e=g[t+"Palette"];break;case 0:case 1:e="top"==g[l(m(t))+"Align"]||"left"==g[l(m(t))+"Align"]?[0,g[o(m(t))]]:[g[o(m(t))],0]}return e}(t),f["dom_"+t]=function(t,n){var r=[],a=g.key[t];if(a)switch(t){case"color":case"area":r=n.reduce(function(t,e){return t.includes(b(e,a))||t.push(b(e,a)),t},[]);break;case 0:case 1:r=g.nameIsNum||1==t?[null!==g[m(t)+"Min"]?g[m(t)+"Min"]:e.min(n,function(t){return b(t,a,!0)}),null!==g[m(t)+"Max"]?g[m(t)+"Max"]:e.max(n,function(t){return b(t,a,!0)})]:n.map(function(t){return b(t,a,!1)})}return r}(t,s),f["the_"+t]=function(t){var n;switch(t){case"color":n=e.scaleOrdinal().range(f["range_"+t]);break;case 0:case 1:n=g.nameIsNum||1==t?e.scaleLinear().range(f["range_"+t]):"line"==g.type?e.scalePoint().range(f["range_"+t]):e.scaleBand().range(f["range_"+t]).paddingInner(.1).paddingOuter(.1)}return n}(t),f["the_"+t]&&f["dom_"+t]&&f["the_"+t].domain(f["dom_"+t]),f["format_"+t]="function"==typeof g[t+"Parameter"]?g[t+"Parameter"]:"string"==typeof g[t+"Parameter"]?function(n){return e.format(g[t+"Parameter"])(n)}:function(e){var n=g["format"+t.toString().toUpperCase()+"Divider"],r=g["format"+t.toString().toUpperCase()+"Prepend"],a=g["format"+t.toString().toUpperCase()+"Append"];return r+(1==g[t+"Data"]||g.nameIsNum?e/n:e)+a},t){case 0:case 1:D(m(t),f.container_rule),g[m(t)+"Grid"]&&D(m(t),f.container_grid,!0);case"color":if(g.colorPalette.length)break}}),f.container_graph=f.container.insert("g").attr("class",i+"graph"),"pie"==g.type&&f.container_graph.attr("transform","translate("+g.width/2+","+g.height/2+")"),g.width==d.width&&g.height==d.height&&s.length>9?console.warn(n+" Width and height was not adjusted. graph elements may not fit in the canvas"):g.width<d.width&&g.height<d.height&&console.warn(n+" set canvas width and or height may be too small.\n Tip: The given height and width are not absolute and act more like aspect ratios. svgs are responsive and will shrink along with content."),("line"!=g.type||g.linePoints)&&(f.blob=f.container_graph.selectAll(f.graph_item_element).data(s,function(t){return b(t,g.key[0])})),f.dv_init=!1,document.addEventListener("scroll",function(e){u.getBoundingClientRect().top<.5*t.innerHeight&&!f.dv_init&&(f.dv_init=!0,setTimeout(function(){S(s)},g.delay))},!0)},S=function(t){console.log(n,"-------------------------------------------------------------------","\n","calculated",f,"\n","data",t,"\n","args",g,"\n","\n","x","\n","domain",f["dom_"+g.xData],"\n","range",f["range_"+g.xData],"\n","\n","y","\n","domain",f["dom_"+g.yData],"\n","range",f["range_"+g.yData],"\n","\n","\n","color","\n","domain",f.dom_color,"\n","range",f.range_color,"\n","\n"),"pie"==g.type||(r.forEach(function(t){g[t+"Ticks"]&&(f["rule_"+t].transition(f.duration).call(f["axis_"+t]).attr("font-family","inherit").attr("font-size",null),g[t+"Grid"]&&(f["rule_grid_"+t].call(f["axis_grid_"+t]),f["rule_grid_"+t].selectAll(".tick").attr("class",function(e,n){var r="grid";return f["rule_"+t].selectAll(".tick").each(function(t){t==e&&(r+=" tick-aligned")}),r})))}),"line"==g.type&&(g.lineFill&&(f.fill=f.container_graph.append("path").attr("class",i+"fill"+(null!==g.lineFillColor||null!==g.lineColor?" has-color":" no-color")).attr("fill-opacity",g.lineFillOpacity),f.fill.transition(f.duration).attrTween("d",function(){return T(t,!0)}),(g.lineFillColor||g.lineColor)&&f.fill.attr("fill",g.lineFillColor||g.lineColor)),f.line=f.container_graph.append("path").attr("class",i+"line"+(null!==g.lineColor?" has-color":" no-color")).attr("fill","none").attr("stroke-width",g.lineWeight).attr("stroke-linejoin","round").attr("stroke-dasharray",g.lineDash).attr("stroke-opacity",1).attr("stroke-dasharray","0,0").transition(f.duration).attrTween("d",function(){return T(t,!1)}),g.lineColor&&f.line.attr("stroke",g.lineColor))),("line"!=g.type||g.linePoints)&&(f.blobWrap=f.blob.enter().append("g").attr("class",function(t){return i+"graph-item "+i+b(t,g.key[0])}),f.blobItem=f.blobWrap.append(f.graph_item_element),"pie"!==g.type&&(f.blobItem.attr("line"==g.type||"scatter"==g.type?"cx":"x",function(t,e){return A("x",t,e,!0)}).attr("line"==g.type||"scatter"==g.type?"cy":"y",function(t,e){return A("y",t,e,!0)}),f.blobWrap.select(f.graph_item_element).transition(f.duration).attr("line"==g.type||"scatter"==g.type?"cx":"x",function(t,e){return A("x",t,e,!1)}).attr("line"==g.type||"scatter"==g.type?"cy":"y",function(t,e){return A("y",t,e,!1)})),"pie"==g.type?f.blobItem.transition(f.duration).attrTween("d",function(n,r){return function(t,n,r){n=n||!1;var a=Math.min(.375*g.width,.375*g.height),i=e.interpolate(t.endAngle,t.startAngle),o=e.arc().outerRadius(1==n?a:.875*a).innerRadius(1==n?.75*a:a*g.piInRadius);return function(e){return t.startAngle=i(e),o(t)}}(C(t)[r])}):"line"==g.type||"scatter"==g.type?f.blobItem.attr("r",function(t,e){return v(0,0,!0)}).transition(f.duration).attr("r",function(t,e){return v(0,0,!1)}):f.blobItem.attr("width",function(t,e){return _("x",t,0,!0)}).attr("height",function(t,e){return _("y",t,0,!0)}).transition(f.duration).attr("width",function(t,e){return _("x",t,0,!1)}).attr("height",function(t,e){return _("y",t,0,!1)}),g.colorPalette.length?f.blobItem.attr("fill",function(t,e){return f.the_color(b(t,g.key.color))}):"line"==g.type&&(g.linePointsColor||g.lineColor)&&f.blobItem.attr("fill",function(){return g.linePointsColor||g.lineColor})),g.xTicks&&g.yTicks&&("pie"!=g.type||g.piLabelStyle&&g.colorLegend)||(f.blobText=f.blobWrap.append("text"),[0,1].forEach(function(t){("pie"!==g.type&&!g[m(t)+"Ticks"]||"pie"==g.type&&(0==t&&!g.colorLegend||1==t&&!g.piLabelStyle))&&(f["blobText_"+t]=f.blobText.append("tspan").attr("class",i+"graph-item-data-"+t).attr("dominant-baseline","middle").attr("text-anchor",function(t,e){return n="middle","pie"==g.type||(0==g.yData&&(n="start"),r.forEach(function(t){0==g[l(t)+"Data"]&&"right"==g[l(t)+"Align"]&&(n="end")})),n;var n}).attr("font-size",null).text(function(e,n){return f["format_"+t](b(e,g.key[t]))}).attr("x",k("x",t)).attr("y",k("y",t)))}),f.mLength=function(t,e){return length=f.blobText?f.blobText.nodes()[e].getBoundingClientRect()[o(t)]:0,length+15},f.blobText.attr("class",function(t,e){var n=i+"graph-item-text";return[0,1].forEach(function(r){var a,i,o,l;(1==r&&(parseFloat(_(m(r),t,0,!1))<f.mLength(m(r),e)||g.colorPalette.length>0&&parseFloat(_(m(r),t,0,!1))>=f.mLength(m(r),e)&&((a=f.the_color(b(t,g.key.color))).match(/^rgb/)?(i=(a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],o=a[2],l=a[3]):(i=(a=+("0x"+a.slice(1).replace(a.length<5&&/./g,"$&$&")))>>16,o=a>>8&255,l=255&a),Math.sqrt(i*i*.299+o*o*.587+l*l*.114)>170))||"line"==g.type)&&(n+=" dark")}),n}).attr("transform",function(t,e){return"translate("+w("x",t,e,!0)+","+w("y",t,e,!0)+")"}).style("opacity",0),f.blobWrap.select("text").transition(f.duration).attr("transform",function(t,e){return"translate("+w("x",t,e)+","+w("y",t,e)+")"}).style("opacity",1)),g.colorLegend&&(f.container_legend=f.container.append("g").attr("class",i+"legend"),f.dom_color.forEach(function(t,e){f.legend=f.container_legend.append("g").attr("class",i+"legend-item"),f.legend.append("rect").attr("width","1em").attr("height","1em").attr("fill",f.the_color(t)),f.legend.append("text").text(t).attr("dominant-baseline","middle").attr("x","2em").attr("y",".625em"),f.legend.attr("transform","translate(0, "+e*f.legend.nodes()[0].getBoundingClientRect().height+")")}),f.container_legend.attr("opacity","0").attr("transform","translate("+P("x")+","+P("y")+")"),f.container_legend.transition(f.duration).attr("opacity","1"))};if("text"==g.srcType||"rows"==g.srcType){var I=u.querySelector('script[type="application/json"]').innerHTML;I.isValidJSONString()?L(JSON.parse(I)):console.error("Data input may not be valid. Please check and update the syntax")}else switch(g.srcPath.getFileExtension()){case"csv":e.csv(g.srcPath,function(t){return t}).then(L);break;case"tsv":e.tsv(g.srcPath,function(t){return t}).then(L);break;default:e.json(g.srcPath,function(t){return t}).then(L)}},t._1p21=n}(window,d3);